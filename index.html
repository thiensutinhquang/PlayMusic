<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nội dung kênh Multimedia MSTQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Display:wght@400;700&display=swap" rel="stylesheet">
    <!-- Fuse.js for fuzzy search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    <style>
        :root {
            --primary-color: #FFD700;
            --secondary-color: #f39c12;
            --text-color: #333;
            --link-color: #555;
            --link-hover-color: var(--primary-color);
            --background-color: #f8f8f8;
            --card-background-color: #fff;
            --border-color: #eee;
            --dark-mode-background: #121212;
            --dark-mode-text: #e0e0e0;
            --dark-mode-card: #1e1e1e;
            --dark-mode-border: #333;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            --shadow-dm: 0 2px 10px rgba(0, 0, 0, 0.5);
            --accent-color: #2196F3;
        }
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            font-size: 16px;
            scroll-behavior: smooth;
            transition: background-color 0.3s, color 0.3s;
        }
        body.dark-mode {
            background-color: var(--dark-mode-background);
            color: var(--dark-mode-text);
            --card-background-color: var(--dark-mode-card);
            --border-color: var(--dark-mode-border);
            --shadow: var(--shadow-dm);
            --link-color: #9cb3ce;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: var(--card-background-color);
            padding: 20px 0;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        body.dark-mode .header {
            background-color: var(--dark-mode-card);
            border-bottom: 1px solid var(--dark-mode-border);
        }
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        .logo {
            margin-right: 20px;
            margin-bottom: 10px;
        }
        .logo h1 {
            margin: 0;
            font-size: 2em;
        }
        .logo h1 a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .navbar ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .navbar li {
            margin-left: 0;
        }
        .navbar a {
            text-decoration: none;
            color: var(--link-color);
            transition: color 0.3s ease;
            font-size: 1em;
            padding: 5px 10px;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .navbar a i {
            font-size: 1.2em;
        }
        body.dark-mode .navbar a {
            color: var(--dark-mode-text);
        }
        .navbar a:hover {
            color: var(--link-hover-color);
        }
        body.dark-mode .navbar a:hover {
            color: var(--primary-color);
        }
        .main-content {
            display: flex;
            gap: 30px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        .main-area {
            flex: 1 1 70%;
            min-width: 250px;
        }
        .sidebar {
            flex: 1 1 25%;
            min-width: 200px;
        }
        .card {
            background-color: var(--card-background-color);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: background-color 0.3s, box-shadow 0.3s, border-color 0.3s;
        }
        body.dark-mode .card {
            background-color: var(--dark-mode-card);
            box-shadow: var(--shadow-dm);
            border: 1px solid var(--dark-mode-border);
        }
        .music-list-enhanced {
            padding: 20px;
            background-color: var(--card-background-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            transition: background-color 0.3s, box-shadow 0.3s, border-color 0.3s;
        }
        body.dark-mode .music-list-enhanced {
            background-color: var(--dark-mode-card);
            box-shadow: var(--shadow-dm);
            border: 1px solid var(--dark-mode-border);
        }
        .music-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }
        #now-playing-info {
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
            color: var(--secondary-color);
            min-height: 1.2em;
            transition: color 0.3s;
        }
        body.dark-mode #now-playing-info {
            color: #f39c12;
        }
        .search-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            position: relative;
        }
        #music-search {
            flex-grow: 1;
            padding: 10px 45px 10px 15px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        body.dark-mode #music-search {
            background-color: #333;
            color: var(--dark-mode-text);
            border-color: var(--dark-mode-border);
        }
        #mic-button {
            position: absolute;
            right: 120px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.3em;
            color: var(--link-color);
            top: 50%;
            transform: translateY(-50%);
            transition: color 0.3s ease;
        }
        #mic-button.listening {
            color: var(--primary-color);
        }
        #mic-button:hover {
            color: var(--link-hover-color);
        }
        #search-button {
            background-color: var(--primary-color);
            border: none;
            color: #333;
            font-weight: bold;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1em;
        }
        #search-button:hover {
            background-color: #e6c000;
        }
        .checkbox-group label {
            margin-right: 15px;
            font-weight: 600;
        }
        #music-list {
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        .song-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }
        .song-item:last-child {
            border-bottom: none;
        }
        .song-item:hover {
            background-color: #fff3b0;
        }
        .song-item .title {
            font-weight: bold;
        }
        mark.highlight {
            background-color: #ffeb3b;
            font-weight: bold;
        }
        #lyrics-popup {
            display: none;
            position: fixed;
            top: 10%;
            left: 50%;
            transform: translateX(-50%);
            max-width: 600px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            padding: 20px;
            z-index: 1000;
        }
        #lyrics-popup h3 {
            margin-top: 0;
        }
        #lyrics-popup .close-btn {
            cursor: pointer;
            float: right;
            font-size: 1.2em;
            font-weight: bold;
            color: #999;
        }
        #lyrics-content p {
            margin: 8px 0;
        }
        #overlay {
            display: none;
            position: fixed;
            top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.5);
            z-index: 900;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <h1><a href="#">Multimedia MSTQ</a></h1>
                </div>
                <nav class="navbar">
                    <ul>
                        <li><a href="#"><i class="fas fa-home"></i> Trang chủ</a></li>
                        <li><a href="#"><i class="fas fa-music"></i> Âm nhạc</a></li>
                        <li><a href="#"><i class="fas fa-video"></i> Video</a></li>
                        <li><a href="#"><i class="fas fa-info-circle"></i> Giới thiệu</a></li>
                    </ul>
                </nav>
                <button class="hamburger-menu" aria-label="Mở menu">&#9776;</button>
            </div>
        </header>

        <main class="main-content">
            <section class="main-area">
                <div class="card music-list-enhanced">
                    <div class="music-controls">
                        <h2>Danh sách âm nhạc nâng cấp</h2>
                        <div id="now-playing-info">Chưa có bài hát nào được phát</div>
                    </div>
                    <div class="search-input-group">
                        <input type="text" id="music-search" placeholder="Tìm kiếm bài hát..." aria-label="Tìm kiếm bài hát" autocomplete="off" />
                        <button id="mic-button" aria-label="Bật tắt tìm kiếm giọng nói" title="Nhấn để nói"><i class="fas fa-microphone"></i></button>
                        <button id="search-button" aria-label="Tìm kiếm">Tìm kiếm</button>
                    </div>
                    <div class="checkbox-group" aria-label="Tùy chọn tìm kiếm">
                        <label><input type="checkbox" id="search-title" checked /> Tiêu đề</label>
                        <label><input type="checkbox" id="search-artist" checked /> Nghệ sĩ</label>
                        <label><input type="checkbox" id="search-lyrics" /> Lời bài hát</label>
                    </div>
                    <div id="music-list"></div>
                </div>
            </section>

            <aside class="sidebar">
                <div class="card widget">
                    <h3>Liên kết nhanh</h3>
                    <ul>
                        <li><a href="#">Trang chủ</a></li>
                        <li><a href="#">Âm nhạc</a></li>
                        <li><a href="#">Video</a></li>
                        <li><a href="#">Liên hệ</a></li>
                    </ul>
                </div>
            </aside>
        </main>

        <footer class="footer">
            <div class="footer-content">
                <nav class="footer-nav">
                    <ul>
                        <li><a href="#">Chính sách bảo mật</a></li>
                        <li><a href="#">Điều khoản sử dụng</a></li>
                        <li><a href="#">Hỗ trợ</a></li>
                    </ul>
                </nav>
                <div>&copy; 2025 Multimedia MSTQ</div>
            </div>
        </footer>
    </div>

    <!-- Popup lyrics -->
    <div id="overlay"></div>
    <div id="lyrics-popup" role="dialog" aria-modal="true" aria-labelledby="lyrics-title">
      <span class="close-btn" id="close-lyrics" aria-label="Đóng">&times;</span>
      <h3 id="lyrics-title">Lời bài hát</h3>
      <div id="lyrics-content"></div>
    </div>

    <script>
        // Dữ liệu bài hát mẫu (bạn có thể mở rộng thêm)
        const songData = [
            { title: "Bài hát của Đen Vâu về biển", artist: "Đen Vâu", description: "Biển xanh mênh mông, sóng vỗ bờ..." },
            { title: "Nơi này có anh", artist: "Sơn Tùng M-TP", description: "Anh nơi đây, chờ em về..." },
            { title: "Em gái mưa", artist: "Hương Tràm", description: "Em gái mưa, em đến bên anh..." },
            { title: "Có chắc yêu là đây", artist: "Sơn Tùng M-TP", description: "Có chắc yêu là đây, là đây..." },
            { title: "Lạc trôi", artist: "Sơn Tùng M-TP", description: "Anh lạc trôi giữa dòng đời..." },
            { title: "Hồng nhan", artist: "Jack", description: "Hồng nhan, em là ai..." },
            { title: "Sóng gió", artist: "Jack & K-ICM", description: "Sóng gió cuộc đời..." },
            { title: "Chạy ngay đi", artist: "Sơn Tùng M-TP", description: "Chạy ngay đi, đừng chần chừ..." },
            { title: "Cô gái m52", artist: "HuyR", description: "Cô gái m52, em là ai..." },
            { title: "Đi về nhà", artist: "Đen Vâu & JustaTee", description: "Đi về nhà thôi, đừng ngần ngại..." }
        ];

        let currentSearchQuery = '';

        function createFuseInstance() {
            const keys = [];
            if(document.getElementById('search-title').checked) keys.push('title');
            if(document.getElementById('search-artist').checked) keys.push('artist');
            if(document.getElementById('search-lyrics').checked) keys.push('description');
            return new Fuse(songData, {
                keys,
                threshold: 0.4,
                includeMatches: true,
                ignoreLocation: true,
            });
        }

        const musicListEl = document.getElementById('music-list');
        const musicSearchInput = document.getElementById('music-search');
        const searchButton = document.getElementById('search-button');
        const micButton = document.getElementById('mic-button');
        const nowPlayingInfo = document.getElementById('now-playing-info');

        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, function(m) {
                return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
            });
        }

        function highlightText(text, indices) {
            let result = '';
            let lastIndex = 0;
            indices.forEach(([start, end]) => {
                result += escapeHtml(text.substring(lastIndex, start));
                result += `<mark class="highlight">${escapeHtml(text.substring(start, end + 1))}</mark>`;
                lastIndex = end + 1;
            });
            result += escapeHtml(text.substring(lastIndex));
            return result;
        }

        function renderSongs(songs, fuseResults = []) {
            musicListEl.innerHTML = '';
            if (songs.length === 0) {
                musicListEl.innerHTML = '<p>Không tìm thấy bài hát phù hợp.</p>';
                nowPlayingInfo.textContent = 'Không tìm thấy bài hát phù hợp.';
                return;
            }
            songs.forEach((song, idx) => {
                const div = document.createElement('div');
                div.className = 'song-item';
                div.setAttribute('tabindex', '0');
                div.dataset.index = idx;

                const fuseResult = fuseResults.find(r => r.item === song);

                let titleHTML = escapeHtml(song.title);
                if (fuseResult && fuseResult.matches) {
                    fuseResult.matches.forEach(match => {
                        if (match.key === 'title') {
                            titleHTML = highlightText(song.title, match.indices);
                        }
                    });
                }

                div.innerHTML = `<div class="title">${titleHTML}</div><div class="artist">${escapeHtml(song.artist)}</div>`;

                div.addEventListener('click', () => {
                    showLyricsPopup(song);
                    nowPlayingInfo.textContent = `Đang phát: ${song.title} - ${song.artist}`;
                });

                musicListEl.appendChild(div);
            });
            nowPlayingInfo.textContent = `Tìm thấy ${songs.length} bài hát phù hợp.`;
        }

        function highlightLyricsLine(line, keyword) {
            if (!keyword) return escapeHtml(line);
            const regex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
            return escapeHtml(line).replace(regex, '<mark class="highlight">$1</mark>');
        }

        const lyricsPopup = document.getElementById('lyrics-popup');
        const lyricsContent = document.getElementById('lyrics-content');
        const overlay = document.getElementById('overlay');
        const closeLyricsBtn = document.getElementById('close-lyrics');

        function showLyricsPopup(song) {
            lyricsPopup.querySelector('#lyrics-title').textContent = `${song.title} - ${song.artist}`;
            lyricsContent.innerHTML = '';
            if (song.description) {
                const lines = song.description.split(/[\.\n]/).filter(Boolean);
                lines.forEach(line => {
                    const p = document.createElement('p');
                    p.innerHTML = highlightLyricsLine(line, currentSearchQuery);
                    lyricsContent.appendChild(p);
                });
            } else {
                lyricsContent.textContent = 'Chưa có lời bài hát.';
            }
            overlay.style.display = 'block';
            lyricsPopup.style.display = 'block';
            lyricsPopup.focus();
        }
        closeLyricsBtn.addEventListener('click', () => {
            lyricsPopup.style.display = 'none';
            overlay.style.display = 'none';
        });
        overlay.addEventListener('click', () => {
            lyricsPopup.style.display = 'none';
            overlay.style.display = 'none';
        });

        function searchSongs(query) {
            currentSearchQuery = query.trim();
            if (!currentSearchQuery) {
                alert('Vui lòng nhập từ khóa tìm kiếm!');
                musicSearchInput.focus();
                return;
            }
            const fuse = createFuseInstance();
            const results = fuse.search(currentSearchQuery);
            const matchedSongs = results.map(r => r.item);
            renderSongs(matchedSongs, results);

            setTimeout(() => {
                const firstSongEl = musicListEl.querySelector('.song-item');
                if (firstSongEl) {
                    firstSongEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstSongEl.focus();
                }
            }, 100);
        }

        searchButton.addEventListener('click', () => {
            searchSongs(musicSearchInput.value);
        });

        musicSearchInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                searchSongs(musicSearchInput.value);
            }
        });

        ['search-title', 'search-artist', 'search-lyrics'].forEach(id => {
            document.getElementById(id)?.addEventListener('change', () => {
                if (musicSearchInput.value.trim()) {
                    searchSongs(musicSearchInput.value.trim());
                }
            });
        });

        // Speech-to-text (microphone)
        let recognition;
        let isListening = false;
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'vi-VN';
            recognition.interimResults = false;
            recognition.continuous = false;

            recognition.onstart = () => {
                isListening = true;
                micButton.classList.add('listening');
                micButton.title = 'Đang nghe... Nhấn để dừng';
            };
            recognition.onend = () => {
                isListening = false;
                micButton.classList.remove('listening');
                micButton.title = 'Nhấn để nói';
            };
            recognition.onerror = (event) => {
                isListening = false;
                micButton.classList.remove('listening');
                micButton.title = 'Nhấn để nói';
                alert('Lỗi nhận dạng giọng nói: ' + event.error);
            };
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                musicSearchInput.value = transcript;
                searchSongs(transcript);
            };
            micButton.addEventListener('click', () => {
                if (isListening) recognition.stop();
                else recognition.start();
            });
        } else {
            micButton.style.display = 'none';
        }

        // Khởi tạo render danh sách đầy đủ lúc đầu
        renderSongs(songData);
    </script>
</body>
</html>
