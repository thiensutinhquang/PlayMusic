<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Play Nh·∫°c MSTQ - Thi√™n S·ª© Tinh Quang</title>
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Fuse.js for fuzzy search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>
    
    <style>
        /* ==============================================
        H·ªÜ TH·ªêNG THI·∫æT K·∫æ & BI·∫æN CSS
        ============================================== */
        :root {
            /* B·∫£ng m√†u ch√≠nh */
            --primary-color: #f59e0b; /* Amber 500 */
            --primary-hover: #d97706; /* Amber 600 */
            --secondary-color: #3b82f6; /* Blue 500 */
            --danger-color: #ef4444; /* Red 500 */
            
            /* M√†u cho ch·∫ø ƒë·ªô S√°ng */
            --bg-light: #f1f5f9; /* Slate 100 */
            --card-bg-light: #ffffff;
            --text-light: #1e293b; /* Slate 800 */
            --text-muted-light: #64748b; /* Slate 500 */
            --border-light: #e2e8f0; /* Slate 200 */

            /* M√†u cho ch·∫ø ƒë·ªô T·ªëi */
            --bg-dark: #0f172a; /* Slate 900 */
            --card-bg-dark: #1e293b; /* Slate 800 */
            --text-dark: #e2e8f0; /* Slate 200 */
            --text-muted-dark: #94a3b8; /* Slate 400 */
            --border-dark: #334155; /* Slate 700 */

            /* ƒê·ªï b√≥ng */
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            
            /* Hi·ªáu ·ª©ng chuy·ªÉn ƒë·ªông */
            --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);

            /* Font ch·ªØ */
            --font-sans: 'Be Vietnam Pro', sans-serif;

            /* M·∫∑c ƒë·ªãnh l√† giao di·ªán S√°ng */
            --bg-current: var(--bg-light);
            --card-bg-current: var(--card-bg-light);
            --text-current: var(--text-light);
            --text-muted-current: var(--text-muted-light);
            --border-current: var(--border-light);
        }

        body.dark-mode {
            --bg-current: var(--bg-dark);
            --card-bg-current: var(--card-bg-dark);
            --text-current: var(--text-dark);
            --text-muted-current: var(--text-muted-dark);
            --border-current: var(--border-dark);
        }
        
        /* ==============================================
        PHONG C√ÅCH C∆† B·∫¢N & TO√ÄN C·ª§C
        ============================================== */
        html { scroll-behavior: smooth; }
        
        body {
            font-family: var(--font-sans);
            background-color: var(--bg-current);
            color: var(--text-current);
            transition: background-color var(--transition-fast), color var(--transition-fast);
            line-height: 1.6;
            padding-bottom: 90px; /* T·∫°o kh√¥ng gian cho thanh ƒëi·ªÅu khi·ªÉn */
        }
        
        .container { max-width: 1280px; margin: 0 auto; padding: 1rem 1.5rem; }
        
        .card {
            background-color: var(--card-bg-current);
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-current);
            transition: var(--transition-slow);
            padding: 1.25rem 1.5rem;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }
        
        /* ==============================================
        HEADER & ƒêI·ªÄU H∆Ø·ªöNG
        ============================================== */
        .header {
            background-color: rgba(255, 255, 255, 0.7);
            border-bottom: 1px solid var(--border-current);
            padding: 0.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(8px);
            height: 140px; /* TƒÉng chi·ªÅu cao header ƒë·ªÉ ch·ª©a logo l·ªõn */
        }
        
        body.dark-mode .header { background-color: rgba(15, 23, 42, 0.7); }

        .header-content { display: flex; justify-content: space-between; align-items: center; }
        
        .logo { display: flex; align-items: center; gap: 1.5rem; }
        .logo h1 { margin: 0; font-size: 1.8rem; font-weight: 700; }
        .logo a { color: var(--text-current); text-decoration: none; transition: var(--transition-fast); display: flex; align-items: center; gap: 1.5rem; }
        .logo a:hover { color: var(--primary-color); }
        
        .new-nav-btn {
            display: inline-flex; align-items: center; gap: 0.5rem; background-color: transparent;
            color: var(--text-muted-current); padding: 0.6rem 1rem; border-radius: 8px;
            text-decoration: none; font-weight: 500; font-size: 0.95rem; border: 2px solid transparent;
            transition: var(--transition-fast); white-space: nowrap;
        }
        .new-nav-btn:hover { color: var(--text-current); background-color: var(--bg-current); transform: translateY(-2px); }
        .new-nav-btn:active { transform: scale(0.95); }
        .new-nav-btn.active { color: var(--primary-color); font-weight: 700; background-color: var(--bg-current); }
        
        .platforms-dropdown, .theme-dropdown { position: relative; }
        
        .platforms-menu, .theme-menu {
            display: none; position: absolute; top: calc(100% + 10px); right: 0;
            background-color: var(--card-bg-current); border-radius: 8px; box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-current); width: 220px; z-index: 1010;
            opacity: 0; transform: translateY(10px); transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .theme-menu { padding: 1rem; width: auto; }
        .platforms-menu.show, .theme-menu.show { display: block; opacity: 1; transform: translateY(0); }
        .platforms-menu a { display: flex; align-items: center; gap: 1rem; padding: 0.75rem 1rem; color: var(--text-muted-current); text-decoration: none; transition: var(--transition-fast); font-size: 0.95rem; }
        .platforms-menu a:hover { background-color: var(--primary-color); color: #fff; }
        .platforms-menu a i { font-size: 1.25rem; width: 20px; text-align: center; }
        
        /* ==============================================
        M√ÄN H√åNH CH√ÄO (SPLASH SCREEN)
        ============================================== */
        #splash-screen { 
            position: fixed; inset: 0; z-index: 9999; 
            opacity: 1; 
            transition: opacity 1.5s ease-out 4.5s, visibility 1.5s ease-out 4.5s; 
            visibility: visible;
            display: flex; justify-content: center; align-items: center; 
            background: #000;
            overflow: hidden;
        }
        #splash-screen.hidden { opacity: 0; visibility: hidden; }
        #splash-logo-container { width: 250px; height: 250px; position: relative; z-index: 10; }
        #splash-logo-placeholder svg, #header-logo-placeholder svg { width: 100%; height: 100%; object-fit: contain; }
        
        /* ==============================================
        HI·ªÜU ·ª®NG LOGO & V≈® TR·ª§
        ============================================== */
        
        /* Hi·ªáu ·ª©ng Logo Header khi nh·∫°c ph√°t */
        #header-logo-placeholder #human-body.breathing-effect { animation: breathe 4s infinite ease-in-out; }
        #header-logo-placeholder #chakra-system.energy-flow-active { stroke-dasharray: 1000; stroke-dashoffset: 1000; animation: flow-animation 3s linear infinite; }
        #header-logo-placeholder #logo-text-trucchichantam.highlight-text { fill: gold; }

        @keyframes breathe {
            0%, 100% { transform: scale(1); transform-origin: center; }
            50% { transform: scale(1.03); transform-origin: center; }
        }
        @keyframes flow-animation {
            from { stroke-dashoffset: 1000; }
            to { stroke-dashoffset: 0; }
        }

        /* Hi·ªáu ·ª©ng v≈© tr·ª• n·ªÅn */
        .stars, .stars2, .stars3 {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            width: 100%; height: 100%;
            display: block;
            background: transparent;
        }
        .stars { animation: rotate-stars 150s linear infinite; }
        .stars2 { animation: rotate-stars 100s linear infinite; }
        .stars3 { animation: rotate-stars 50s linear infinite; }
        @keyframes rotate-stars { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        @keyframes twinkle {
            0% { transform: scale(0.5); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
            100% { transform: scale(0.5); opacity: 0.5; }
        }

        /* ==============================================
        N·ªòI DUNG CH√çNH
        ============================================== */
        .main-content { display: grid; grid-template-columns: 1fr; gap: 2rem; margin-top: 2rem; }
        
        /* ==============================================
        TR√åNH PH√ÅT NH·∫†C - THANH ƒêI·ªÄU KHI·ªÇN D∆Ø·ªöI
        ============================================== */
        #player-bar {
            position: fixed;
            bottom: 0; left: 0; right: 0;
            height: 90px;
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-current);
            z-index: 1001;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            align-items: center;
            gap: 2rem;
        }
        body.dark-mode #player-bar {
            background-color: rgba(15, 23, 42, 0.7);
        }

        #player-bar .now-playing-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 0;
        }
        #player-bar .now-playing-info img {
            width: 56px;
            height: 56px;
            border-radius: 8px;
            object-fit: cover;
        }
        #player-bar .now-playing-info .text-info {
            min-width: 0;
        }

        #player-bar .player-controls-main {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }
        #player-bar .player-buttons {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        #player-bar .player-buttons button {
            background: none;
            border: none;
            color: var(--text-muted-current);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }
        #player-bar .player-buttons button:hover { color: var(--text-current); }
        #player-bar .player-buttons #play-pause-btn {
            background-color: var(--primary-color);
            color: white;
            width: 44px; height: 44px;
            border-radius: 50%;
            font-size: 1.5rem;
        }
        #player-bar .player-buttons #play-pause-btn:hover { background-color: var(--primary-hover); }

        #player-bar .progress-section {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            width: 100%;
            max-width: 500px;
        }
        #player-bar .progress-container { flex-grow: 1; }

        #player-bar .player-actions-right {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 1rem;
        }
        #player-bar .player-actions-right button {
            background: none; border: none; color: var(--text-muted-current); font-size: 1.25rem;
        }
        #player-bar .volume-container { display: flex; align-items: center; gap: 0.5rem; width: 120px; }

        /* ==============================================
        DANH S√ÅCH CH·ªú (QUEUE)
        ============================================== */
        #queue-overlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.5);
            z-index: 1002;
            opacity: 0;
            transition: opacity var(--transition-fast);
            pointer-events: none;
        }
        body.queue-open #queue-overlay {
            opacity: 1;
            pointer-events: all;
        }

        #queue-sidebar {
            position: fixed;
            top: 0; right: 0; bottom: 90px; /* ƒê·ªÉ h·ªü thanh player */
            width: 350px;
            background-color: var(--card-bg-current);
            box-shadow: var(--shadow-lg);
            z-index: 1003;
            transform: translateX(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
        }
        body.queue-open #queue-sidebar {
            transform: translateX(0);
        }
        #queue-sidebar .queue-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-current);
        }
        #queue-sidebar .queue-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .queue-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }
        .queue-item:hover { background-color: var(--bg-current); }
        .queue-item.active-song-in-queue { background-color: var(--primary-color) !important; color: white !important; }
        .queue-item img { width: 40px; height: 40px; border-radius: 4px; }
        
        /* ==============================================
        GIAO DI·ªÜN DANH S√ÅCH NH·∫†C (LIST VIEW)
        ============================================== */
        .song-list-container {
            display: flex;
            flex-direction: column;
        }
        .song-list-header {
            display: grid;
            grid-template-columns: 40px 1fr auto;
            gap: 1rem;
            padding: 0.5rem 1rem;
            border-bottom: 1px solid var(--border-current);
            color: var(--text-muted-current);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        .song-list-item {
            display: grid;
            grid-template-columns: 40px 1fr auto;
            gap: 1rem;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color var(--transition-fast);
        }
        .song-list-item:hover {
            background-color: var(--bg-current);
        }
        .song-list-item .song-index-play {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .song-list-item .index-number {
            transition: opacity var(--transition-fast);
        }
        .song-list-item .play-button {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity var(--transition-fast);
            font-size: 1.5rem;
        }
        .song-list-item:hover .index-number {
            opacity: 0;
        }
        .song-list-item:hover .play-button {
            opacity: 1;
        }
        .song-list-item.active-song .index-number {
            opacity: 0;
        }
        .song-list-item.active-song .play-button {
            opacity: 1;
        }
        .song-list-item .song-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            min-width: 0;
        }
        .song-list-item .artwork {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            object-fit: cover;
        }
        .song-list-item .title-artist {
            min-width: 0;
        }
        .song-list-item .title {
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .song-list-item .artist {
            font-size: 0.875rem;
            color: var(--text-muted-current);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .song-list-item.active-song .title {
            color: var(--primary-color);
        }
        .song-list-item .duration {
            text-align: right;
            font-size: 0.875rem;
            color: var(--text-muted-current);
        }

        /* ==============================================
        RESPONSIVE & MOBILE
        ============================================== */
        .hamburger-menu { display: none; }
        .mobile-nav-overlay { display: none; }
        
        @media (max-width: 1024px) {
            .desktop-nav { display: none; }
            .hamburger-menu {
                display: block;
                color: var(--text-current);
                background: none; border: none; font-size: 1.75rem; cursor: pointer;
            }
            .mobile-nav-overlay {
                display: none;
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                backdrop-filter: blur(4px);
                z-index: 1010;
                opacity: 0;
                transition: opacity var(--transition-fast);
            }
            .mobile-nav-overlay.active {
                display: block;
                opacity: 1;
            }
            .mobile-nav-content {
                position: fixed;
                top: 0; right: -280px;
                width: 280px; height: 100%;
                background-color: var(--card-bg-current);
                box-shadow: var(--shadow-lg);
                z-index: 1020;
                padding: 4rem 1.5rem 1.5rem;
                display: flex; flex-direction: column;
                transition: right 0.3s ease-in-out;
            }
            .mobile-nav-overlay.active .mobile-nav-content {
                right: 0;
            }
            .mobile-nav-content .close-mobile-menu {
                position: absolute;
                top: 1rem; right: 1.5rem;
                font-size: 1.5rem; background: none; border: none;
                color: var(--text-muted-current); cursor: pointer;
            }
            .mobile-nav-content .new-nav-container {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }
             .mobile-nav-content .new-nav-btn {
                padding: 0.8rem;
                font-size: 1rem;
                justify-content: flex-start;
             }
             .mobile-nav-content .platforms-menu {
                 position: static;
                 display: none;
                 opacity: 1;
                 transform: none;
                 box-shadow: none;
                 border: none;
                 width: 100%;
                 margin-top: 0.5rem;
                 padding-left: 1rem;
                 background-color: transparent;
             }
             .mobile-nav-content .platforms-menu.show {
                display: block;
             }

            #mobile-theme-options {
                transition: opacity 0.2s, transform 0.2s;
                opacity: 0;
                transform: translateY(-16px) scale(0.98);
                pointer-events: none;
            }
            #mobile-theme-options:not(.hidden) {
                opacity: 1;
                transform: translateY(0) scale(1);
                pointer-events: auto;
                z-index: 30;
            }
        }

        @media (max-width: 768px) {
            .header { height: 90px; }
            #header-logo-placeholder { width: 72px !important; height: 72px !important; }
            .logo h1 { font-size: 1.25rem; }
            
            #player-bar {
                grid-template-columns: auto 1fr;
                padding: 0.5rem 1rem;
            }
            #player-bar .player-controls-main {
                grid-column: 1 / -1;
                grid-row: 1;
                padding-bottom: 0.5rem;
            }
            #player-bar .now-playing-info {
                grid-column: 1 / -1;
                grid-row: 2;
                justify-content: center;
            }
            #player-bar .player-actions-right { display: none; }
        }
    </style>
</head>
<body class="theme-default">
    <!-- M√†n h√¨nh ch·ªù -->
    <div id="splash-screen">
        <div class="stars"></div>
        <div class="stars2"></div>
        <div class="stars3"></div>
        <div id="splash-logo-container">
            <div id="splash-logo-placeholder"></div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <div class="logo">
                <a href="#">
                    <div id="header-logo-placeholder" style="width: 120px; height: 120px;"></div>
                    <h1>PLAY NH·∫†C MSTQ</h1>
                </a>
            </div>
            
            <div class="header-controls">
                <nav class="desktop-nav flex items-center gap-2">
                    <a href="https://sites.google.com/view/thiensutinhquang" class="new-nav-btn" target="_blank"><i class="ph-bold ph-house"></i><span>Trang Ch·ªß</span></a>
                    <a href="https://thiensutinhquang.github.io/playtholientuc/" class="new-nav-btn" target="_blank"><i class="ph-bold ph-book-open"></i><span>Kho Th∆°</span></a>
                    <div class="platforms-dropdown">
                        <button id="platforms-toggle-desktop" class="new-nav-btn"><i class="ph-bold ph-share-network"></i><span>N·ªÅn T·∫£ng</span><i class="ph-bold ph-caret-down ml-2"></i></button>
                        <div id="platforms-menu-desktop" class="platforms-menu"></div>
                    </div>
                    <div class="theme-dropdown">
                        <button id="theme-toggle-desktop" class="new-nav-btn"><i class="ph-bold ph-palette"></i><span>Giao di·ªán</span></button>
                        <div id="theme-menu-desktop" class="theme-menu">
                             <div class="flex items-center gap-2 justify-center">
                                 <i class="ph-bold ph-sun text-yellow-500"></i>
                                 <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="darkModeToggle" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-color"></div></label>
                                 <i class="ph-bold ph-moon text-slate-400"></i>
                             </div>
                        </div>
                    </div>
                </nav>
                <button class="hamburger-menu" id="hamburger-menu"><i class="ph-bold ph-list"></i></button>
            </div>
        </div>
    </header>

    <!-- Menu cho di ƒë·ªông -->
    <div class="mobile-nav-overlay" id="mobile-nav-overlay">
        <div class="mobile-nav-content">
            <button class="close-mobile-menu" id="close-mobile-menu"><i class="ph-bold ph-x"></i></button>
            <div class="new-nav-container flex flex-col gap-2">
                 <a href="https://sites.google.com/view/thiensutinhquang" class="new-nav-btn" target="_blank"><i class="ph-bold ph-house"></i><span>Trang Ch·ªß</span></a>
                 <a href="https://thiensutinhquang.github.io/playtholientuc/" class="new-nav-btn" target="_blank"><i class="ph-bold ph-book-open"></i><span>Kho Th∆°</span></a>
                <div class="platforms-dropdown">
                     <button id="platforms-toggle-mobile" class="new-nav-btn w-full justify-start"><i class="ph-bold ph-share-network"></i><span>N·ªÅn T·∫£ng</span><i class="ph-bold ph-caret-down ml-auto"></i></button>
                    <div id="platforms-menu-mobile" class="platforms-menu"></div>
                </div>
                 <div class="theme-dropdown">
                    <button id="mobile-theme-menu" class="new-nav-btn w-full justify-start"><i class="ph-bold ph-palette"></i><span>Giao di·ªán</span></button>
                    <div id="mobile-theme-options" class="hidden pl-8 pt-2 space-y-4">
                         <div class="theme-switch flex items-center gap-2">
                             <i class="ph-bold ph-sun text-yellow-500"></i>
                            <label class="relative inline-flex items-center cursor-pointer"><input type="checkbox" id="darkModeToggleMobile" class="sr-only peer"><div class="w-11 h-6 bg-slate-200 rounded-full peer dark:bg-slate-700 peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary-color"></div></label>
                            <i class="ph-bold ph-moon text-slate-400"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- N·ªôi dung ch√≠nh -->
    <main class="container main-content">
        <div class="main-column space-y-6">
             <div class="card" id="music-section">
                <div class="flex flex-col sm:flex-row justify-between items-center mb-4 gap-4">
                     <h2 class="text-xl font-bold">Th∆∞ vi·ªán nh·∫°c</h2>
                     <div id="category-menu" class="flex flex-wrap justify-center gap-2"></div>
                </div>
                <!-- Thanh t√¨m ki·∫øm -->
                <div class="relative mb-4">
                    <input type="search" id="search-input" placeholder="T√¨m ki·∫øm b√†i h√°t, ngh·ªá sƒ©..." class="w-full p-3 pl-10 rounded-lg bg-bg-current border border-border-current focus:ring-2 focus:ring-primary-color focus:outline-none transition-shadow">
                    <i class="ph-bold ph-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-muted-current"></i>
                    <button id="search-clear-btn" class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-current hover:text-current hidden cursor-pointer"><i class="ph-bold ph-x"></i></button>
                </div>
                <div id="songs-container" class="song-list-container">
                    <div class="song-list-header">
                        <span>#</span>
                        <span>Ti√™u ƒë·ªÅ</span>
                        <span>Th·ªùi l∆∞·ª£ng</span>
                    </div>
                    <div id="song-list-body">
                         <p class="text-center text-muted-current col-span-full p-4">ƒêang t·∫£i th∆∞ vi·ªán nh·∫°c...</p>
                    </div>
                </div>
                <audio id="audio-player" style="display: none;"></audio>
            </div>
        </div>
    </main>
    
    <!-- Thanh ƒëi·ªÅu khi·ªÉn nh·∫°c c·ªë ƒë·ªãnh -->
    <div id="player-bar">
        <!-- Th√¥ng tin b√†i h√°t ƒëang ph√°t -->
        <div class="now-playing-info">
            <img id="player-album-art" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Album Art">
            <div class="text-info">
                <h4 id="player-song-title" class="font-bold truncate">Ch∆∞a c√≥ nh·∫°c</h4>
                <p id="player-song-artist" class="text-sm text-muted-current truncate">Vui l√≤ng ch·ªçn b√†i h√°t</p>
            </div>
        </div>

        <!-- ƒêi·ªÅu khi·ªÉn ch√≠nh -->
        <div class="player-controls-main">
            <div class="player-buttons">
                <button id="shuffle-btn" title="Tr·ªôn b√†i"><i class="ph-bold ph-shuffle"></i></button>
                <button id="prev-btn" title="B√†i tr∆∞·ªõc"><i class="ph-bold ph-skip-back"></i></button>
                <button id="play-pause-btn" title="Ph√°t/D·ª´ng">
                    <i class="ph-bold ph-play" id="play-icon"></i>
                    <i class="ph-bold ph-pause hidden" id="pause-icon"></i>
                </button>
                <button id="next-btn" title="B√†i k·∫ø ti·∫øp"><i class="ph-bold ph-skip-forward"></i></button>
                <button id="repeat-btn" title="L·∫∑p l·∫°i"><i class="ph-bold ph-repeat"></i></button>
            </div>
            <div class="progress-section">
                <span id="current-time" class="text-xs">0:00</span>
                <div class="progress-container" id="progress-container">
                    <div class="progress-bar" id="progress-bar" style="width: 0%"></div>
                </div>
                <span id="duration" class="text-xs">0:00</span>
            </div>
        </div>

        <!-- C√°c h√†nh ƒë·ªông ph·ª• -->
        <div class="player-actions-right">
             <button id="favorite-btn" title="Y√™u th√≠ch"><i class="ph-bold ph-heart"></i></button>
             <div class="volume-container">
                <i class="ph-bold ph-speaker-high"></i>
                <input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1" class="w-full h-1 bg-border-current rounded-lg appearance-none cursor-pointer">
             </div>
             <button id="queue-toggle-btn" title="Danh s√°ch ch·ªù"><i class="ph-bold ph-list-music"></i></button>
        </div>
    </div>

    <!-- Danh s√°ch ch·ªù (Queue) -->
    <div id="queue-overlay" class="hidden"></div>
    <div id="queue-sidebar">
        <div class="queue-header">
            <h3 class="text-lg font-bold">Danh s√°ch ch·ªù</h3>
        </div>
        <div class="queue-list">
            <ul id="queue-song-list">
                <!-- C√°c b√†i h√°t trong h√†ng ch·ªù s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y -->
            </ul>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // ... (To√†n b·ªô m√£ JavaScript kh√¥ng thay ƒë·ªïi)
        // ==============================================
        // QU·∫¢N L√ù TR·∫†NG TH√ÅI & BI·∫æN TO√ÄN C·ª§C
        // ==============================================
        const config = {
            USER_HANDLE: "minhsutinhquang",
            genreMap: {'new':"Pop",'hot':"Country",'dieu-thu':"Classical",'others':"Reggae",'phap':"Podcasts"},
            platformLinks: [
                { name: 'YouTube', url: 'https://www.youtube.com/channel/UCLdLj1-g4TI5lSmWeD60mnA', icon: 'ph-youtube-logo', color: '#FF0000' },
                { name: 'TikTok', url: 'https://www.tiktok.com/@minhsutinhquang', icon: 'ph-tiktok-logo', color: '#000000' },
                { name: 'Facebook', url: 'https://www.facebook.com/phatphapnhiemmauTinhQuang', icon: 'ph-facebook-logo', color: '#1877F2' },
                { name: 'Telegram', url: 'https://t.me/Giaoly_phap_don_ngo', icon: 'ph-telegram-logo', color: '#24A1DE' },
            ],
            presetThemes: [
                { id: 'default', title: 'M·∫∑c ƒë·ªãnh', style: 'background: linear-gradient(135deg, #f1f5f9, #e2e8f0);' },
                { id: 'tinhquang', title: 'Tinh Quang', bg: '#1a0b2a', cardBg: '#2a1b4a', text: '#FFD700', textMuted: '#e0e0e0', border: '#4a2a6a', style: 'background-color: #1a0b2a;' },
                { id: 'forest', title: 'R·ª´ng Xanh', bg: '#e8f5e9', cardBg: '#ffffff', text: '#1b5e20', textMuted: '#4caf50', border: '#c8e6c9', style: 'background-color: #e8f5e9;' },
            ]
        };

        let state = {
            songData: [],
            currentDisplayData: [],
            currentSongIndex: -1,
            isPlaying: false,
            isShuffling: JSON.parse(localStorage.getItem('isShuffling')) || false,
            repeatMode: localStorage.getItem('repeatMode') || 'none', // 'none', 'all', 'one'
            favoriteSongIds: JSON.parse(localStorage.getItem('favoriteSongIds')) || [],
            audiusDiscoveryHost: null,
            fuse: null,
            sleepTimer: null,
        };

        let dom = {};
        let logoElements = {};

        // ==============================================
        // C√ÅC H√ÄM KH·ªûI T·∫†O & C√ÄI ƒê·∫∂T
        // ==============================================

        async function initializeApp() {
            console.log("·ª®ng d·ª•ng ƒëang kh·ªüi t·∫°o...");
            
            cacheDOMElements();
            createStars(100, document.querySelector('.stars'));
            createStars(50, document.querySelector('.stars2'));
            createStars(20, document.querySelector('.stars3'));

            await loadAndInjectSVG();
            cacheLogoElements();
            setupEventListeners();
            applyInitialSettings();
            renderPlatformLinks();
            renderThemeButtons();
            renderCategoryButtons();
            
            await fetchAudiusData();
            setupFuse();
            loadCategory('all');

            dom.splashScreen.classList.add('visible');

            setTimeout(() => {
                dom.splashScreen.classList.add('hidden');
                dom.body.classList.add('app-loaded');
            }, 5000);
            
            console.log("Kh·ªüi t·∫°o ho√†n t·∫•t.");
        }

        function cacheDOMElements() {
            dom = {
                body: document.body,
                splashScreen: document.getElementById('splash-screen'),
                songsContainer: document.getElementById('song-list-body'), // S·ª≠a l·∫°i
                categoryMenu: document.getElementById('category-menu'),
                audioPlayer: document.getElementById('audio-player'),
                playerBar: document.getElementById('player-bar'),
                playerAlbumArt: document.getElementById('player-album-art'),
                playerSongTitle: document.getElementById('player-song-title'),
                playerSongArtist: document.getElementById('player-song-artist'),
                playPauseBtn: document.getElementById('play-pause-btn'),
                playIcon: document.getElementById('play-icon'),
                pauseIcon: document.getElementById('pause-icon'),
                progressBar: document.getElementById('progress-bar'),
                currentTimeEl: document.getElementById('current-time'),
                durationEl: document.getElementById('duration'),
                shuffleBtn: document.getElementById('shuffle-btn'),
                repeatBtn: document.getElementById('repeat-btn'),
                favoriteBtn: document.getElementById('favorite-btn'),
                nextBtn: document.getElementById('next-btn'),
                prevBtn: document.getElementById('prev-btn'),
                volumeSlider: document.getElementById('volume-slider'),
                queueToggleBtn: document.getElementById('queue-toggle-btn'),
                queueSidebar: document.getElementById('queue-sidebar'),
                queueOverlay: document.getElementById('queue-overlay'),
                queueSongList: document.getElementById('queue-song-list'),
                lyricsContentMain: document.getElementById('lyrics-content-main'),
                searchInput: document.getElementById('search-input'),
                searchClearBtn: document.getElementById('search-clear-btn'),
                currentSleepTimerDisplay: document.getElementById('current-sleep-timer'),
            };
        }

        function cacheLogoElements() {
             logoElements = {
                chakraSystem: document.querySelector('#header-logo-placeholder #chakra-system'),
                humanBody: document.querySelector('#header-logo-placeholder #human-body'),
                trucChiChanTamText: document.querySelector('#header-logo-placeholder #logo-text-trucchichantam'),
             };
        }

        function createStars(count, container) {
            if (!container) return;
            for (let i = 0; i < count; i++) {
                const star = document.createElement('div');
                star.className = 'absolute bg-white rounded-full';
                const size = Math.random() * 2 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 100}%`;
                star.style.left = `${Math.random() * 100}%`;
                star.style.animation = `twinkle ${Math.random() * 5 + 3}s linear infinite`;
                star.style.animationDelay = `${Math.random() * 3}s`;
                container.appendChild(star);
            }
        }

        async function loadAndInjectSVG() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/thiensutinhquang/PlayMusic/main/LOGOvectorFULL.svg');
                if (!response.ok) throw new Error('Kh√¥ng t·∫£i ƒë∆∞·ª£c SVG');
                const svgText = await response.text();
                document.getElementById('splash-logo-placeholder').innerHTML = svgText;
                document.getElementById('header-logo-placeholder').innerHTML = svgText;
            } catch (error) {
                console.error("L·ªói t·∫£i SVG:", error);
                document.getElementById('header-logo-placeholder').innerHTML = `<div class="w-16 h-16 bg-primary-color rounded-full flex items-center justify-center text-white font-bold text-2xl">M</div>`;
            }
        }

        function applyInitialSettings() {
            const savedTheme = JSON.parse(localStorage.getItem('themeState')) || { mode: 'light' };
            updateTheme(savedTheme);
            dom.shuffleBtn.classList.toggle('active-control', state.isShuffling);
            updateRepeatButtonUI();
        }
        
        // ==============================================
        // L·∫§Y D·ªÆ LI·ªÜU & RENDER
        // ==============================================

        async function fetchAudiusData() {
            try {
                const hosts = await getAudiusHosts();
                state.audiusDiscoveryHost = hosts[Math.floor(Math.random() * hosts.length)];
                const userResponse = await fetch(`${state.audiusDiscoveryHost}/v1/users/search?query=${config.USER_HANDLE}&app_name=MSTQPlayer`);
                const userData = await userResponse.json();
                if (!userData.data || userData.data.length === 0) throw new Error("Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng");
                const userId = userData.data[0].id;
                const tracksResponse = await fetch(`${state.audiusDiscoveryHost}/v1/users/${userId}/tracks?limit=1000&app_name=MSTQPlayer`);
                const tracksData = await tracksResponse.json();
                state.songData = tracksData.data.map(track => ({
                    id: track.id,
                    title: track.title,
                    artist: track.user ? track.user.name : 'Ngh·ªá sƒ© kh√¥ng x√°c ƒë·ªãnh',
                    artwork: track.artwork ? (track.artwork['480x480'] || track.artwork.url) : `https://placehold.co/150x150/1e293b/f1f5f9?text=${track.title.charAt(0)}`,
                    duration: track.duration,
                    description: track.description || '',
                    genre: track.genre || 'Kh√¥ng r√µ'
                }));
            } catch (error) {
                console.error("L·ªói khi t·∫£i d·ªØ li·ªáu t·ª´ Audius:", error);
                dom.songsContainer.innerHTML = '<p class="text-center text-red-500 col-span-full">L·ªói khi t·∫£i danh s√°ch nh·∫°c. Vui l√≤ng th·ª≠ l·∫°i sau.</p>';
            }
        }

        async function getAudiusHosts() {
            try {
                const response = await fetch('https://api.audius.co');
                if (!response.ok) throw new Error('Kh√¥ng th·ªÉ l·∫•y danh s√°ch host');
                const data = await response.json();
                return data.data;
            } catch (e) {
                console.warn("Kh√¥ng th·ªÉ l·∫•y danh s√°ch host t·ª´ API, s·ª≠ d·ª•ng danh s√°ch d·ª± ph√≤ng.", e.message);
                return ['https://discoveryprovider.audius.co', 'https://discoveryprovider2.audius.co', 'https://discoveryprovider3.audius.co'];
            }
        }
        
        function setupFuse() {
            const options = {
                keys: ['title', 'artist'],
                includeScore: true,
                threshold: 0.4,
            };
            state.fuse = new Fuse(state.songData, options);
        }

        function renderSongs(tracks) {
            state.currentDisplayData = tracks; 
            dom.songsContainer.innerHTML = !tracks || tracks.length === 0 ? '<p class="text-center text-muted-current col-span-full p-4">Kh√¥ng c√≥ b√†i h√°t n√†o trong m·ª•c n√†y.</p>' : '';
            tracks.forEach((song, displayIndex) => {
                const songItem = document.createElement('div');
                songItem.className = 'song-list-item';
                songItem.dataset.displayIndex = displayIndex; 
                songItem.innerHTML = `
                    <div class="song-index-play">
                        <span class="index-number">${displayIndex + 1}</span>
                        <div class="play-button"><i class="ph-bold ph-play"></i></div>
                    </div>
                    <div class="song-info">
                        <img src="${song.artwork}" alt="${song.title}" class="artwork">
                        <div class="title-artist">
                            <p class="title">${song.title}</p>
                            <p class="artist">${song.artist}</p>
                        </div>
                    </div>
                    <div class="duration">${new Date(song.duration * 1000).toISOString().substr(14, 5)}</div>
                `;
                dom.songsContainer.appendChild(songItem);
            });
            addSongEventListeners();
            renderQueueList(tracks);
            updateUI(); 
        }

        function renderCategoryButtons() {
            const categories = [
                { id: 'all', name: 'üéß T·∫•t c·∫£' }, { id: 'new', name: 'üÜï M·ªõi' },
                { id: 'hot', name: 'üî• N·ªïi b·∫≠t' }, { id: 'dieu-thu', name: 'üé§ Di·ªáu Thu' },
                { id: 'others', name: 'üë§ Kh√°c' }, { id: 'phap', name: 'üìø Ph√°p' },
                { id: 'favorites', name: '‚ù§Ô∏è Y√™u th√≠ch' }
            ];
            dom.categoryMenu.innerHTML = '';
            categories.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'new-nav-btn text-xs';
                btn.innerHTML = cat.name;
                btn.dataset.category = cat.id;
                btn.onclick = () => loadCategory(cat.id);
                dom.categoryMenu.appendChild(btn);
            });
        }

        window.loadCategory = (category) => {
            document.querySelectorAll('#category-menu .new-nav-btn').forEach(btn => btn.classList.remove('active'));
            const activeBtn = document.querySelector(`#category-menu .new-nav-btn[data-category="${category}"]`);
            if (activeBtn) activeBtn.classList.add('active');
            
            dom.searchInput.value = ''; // Clear search when changing category
            
            let filteredSongs = state.songData;
            if (category === 'favorites') {
                filteredSongs = state.songData.filter(s => state.favoriteSongIds.includes(s.id));
            } else if (config.genreMap[category]) {
                filteredSongs = state.songData.filter(s => s.genre && s.genre.toLowerCase() === config.genreMap[category].toLowerCase());
            }
            renderSongs(filteredSongs);
        };

        function renderQueueList(songs) {
            dom.queueSongList.innerHTML = '';
            if (!songs || songs.length === 0) return;
            songs.forEach((song) => {
                const globalIndex = state.songData.findIndex(s => s.id === song.id);
                const li = document.createElement('li');
                li.className = 'queue-item';
                li.dataset.index = globalIndex;
                li.innerHTML = `
                    <img src="${song.artwork}" alt="${song.title}" class="w-10 h-10 rounded-md">
                    <div class="flex-grow min-w-0">
                        <p class="font-semibold truncate">${song.title}</p>
                        <p class="text-sm text-muted-current truncate">${song.artist}</p>
                    </div>
                `;
                li.addEventListener('click', () => playSong(globalIndex));
                dom.queueSongList.appendChild(li);
            });
        }

        // ==============================================
        // ƒêI·ªÄU KHI·ªÇN TR√åNH PH√ÅT
        // ==============================================
        
        function playSong(globalIndex) {
            if (globalIndex < 0 || globalIndex >= state.songData.length) return;
            
            state.currentSongIndex = globalIndex;
            const song = state.songData[globalIndex];
            dom.audioPlayer.src = `${state.audiusDiscoveryHost}/v1/tracks/${song.id}/stream?app_name=MSTQPlayer`;
            dom.audioPlayer.play().catch(e => console.error("L·ªói ph√°t nh·∫°c:", e));
            updateMediaSession();
            updateUI();
        }
        
        function playNext() {
            if (state.songData.length === 0) return;
            let nextIndex;
            if (state.isShuffling) {
                do { nextIndex = Math.floor(Math.random() * state.songData.length); } while (state.songData.length > 1 && nextIndex === state.currentSongIndex);
            } else {
                nextIndex = (state.currentSongIndex + 1) % state.songData.length;
            }
            playSong(nextIndex);
        }

        function playPrev() {
            if (state.songData.length === 0) return;
            let prevIndex;
            if (state.isShuffling) {
                do { prevIndex = Math.floor(Math.random() * state.songData.length); } while (state.songData.length > 1 && prevIndex === state.currentSongIndex);
            } else {
                prevIndex = (state.currentSongIndex - 1 + state.songData.length) % state.songData.length;
            }
            playSong(prevIndex);
        }

        function togglePlayPause() {
            if (state.currentSongIndex === -1 && state.songData.length > 0) {
                playSong(0);
            } else {
                if (dom.audioPlayer.paused) dom.audioPlayer.play();
                else dom.audioPlayer.pause();
            }
        }
        
        // ==============================================
        // C·∫¨P NH·∫¨T GIAO DI·ªÜN & HI·ªÜU ·ª®NG
        // ==============================================

        function updateUI() {
            const song = state.songData[state.currentSongIndex];
            state.isPlaying = !dom.audioPlayer.paused;

            if (song) {
                dom.playerSongTitle.textContent = song.title;
                dom.playerSongArtist.textContent = song.artist;
                dom.playerAlbumArt.src = song.artwork;
                if(dom.lyricsContentMain) dom.lyricsContentMain.innerHTML = song.description ? song.description.replace(/\n/g, '<br>') : '<p class="text-muted-current">Kh√¥ng c√≥ l·ªùi b√†i h√°t.</p>';
                dom.favoriteBtn.classList.toggle('liked', state.favoriteSongIds.includes(song.id));
                dom.favoriteBtn.innerHTML = state.favoriteSongIds.includes(song.id) ? '<i class="ph-fill ph-heart"></i>' : '<i class="ph-bold ph-heart"></i>';
            }

            dom.playIcon.classList.toggle('hidden', state.isPlaying);
            dom.pauseIcon.classList.toggle('hidden', !state.isPlaying);
            
            document.querySelectorAll('.song-list-item').forEach(item => {
                const itemSong = state.currentDisplayData[parseInt(item.dataset.displayIndex)];
                if(!itemSong) return;
                item.classList.toggle('active-song', song && itemSong.id === song.id);
                const indicatorIcon = item.querySelector('.play-button i');
                if (indicatorIcon) indicatorIcon.className = (song && itemSong.id === song.id && state.isPlaying) ? 'ph-bold ph-speaker-high text-primary-color' : 'ph-bold ph-play';
            });

            document.querySelectorAll('#queue-song-list li').forEach(item => {
                item.classList.toggle('active-song-in-queue', parseInt(item.dataset.index) === state.currentSongIndex);
            });

            if (state.isPlaying) {
                activateLogoAnimations();
            } else {
                deactivateLogoAnimations();
            }
        }
        
        function activateLogoAnimations() {
            if (logoElements.humanBody) logoElements.humanBody.classList.add('breathing-effect');
            if (logoElements.chakraSystem) logoElements.chakraSystem.classList.add('energy-flow-active');
            if (logoElements.trucChiChanTamText) logoElements.trucChiChanTamText.classList.add('highlight-text');
        }

        function deactivateLogoAnimations() {
            if (logoElements.humanBody) logoElements.humanBody.classList.remove('breathing-effect');
            if (logoElements.chakraSystem) logoElements.chakraSystem.classList.remove('energy-flow-active');
            if (logoElements.trucChiChanTamText) logoElements.trucChiChanTamText.classList.remove('highlight-text');
        }

        function updateProgress() {
            const { currentTime, duration } = dom.audioPlayer;
            if(duration) {
                dom.progressBar.style.width = `${(currentTime / duration) * 100}%`;
                dom.currentTimeEl.textContent = new Date(currentTime * 1000).toISOString().substr(14, 5);
                dom.durationEl.textContent = new Date(duration * 1000).toISOString().substr(14, 5);
            }
        }

        function updateRepeatButtonUI() {
            dom.repeatBtn.classList.toggle('active-control', state.repeatMode !== 'none');
            dom.repeatBtn.innerHTML = state.repeatMode === 'one' ? '<i class="ph-bold ph-repeat-once"></i>' : '<i class="ph-bold ph-repeat"></i>';
        }

        function updateTheme(theme) {
            localStorage.setItem('themeState', JSON.stringify(theme));
            dom.body.classList.remove('dark-mode', 'preset-theme');
            document.querySelectorAll('.preset-theme-btn').forEach(b => b.classList.remove('active'));
            
            const isDark = theme.mode === 'dark';
            document.getElementById('darkModeToggle').checked = isDark;
            document.getElementById('darkModeToggleMobile').checked = isDark;

            if (isDark) {
                dom.body.classList.add('dark-mode');
            }
        }

        function updateMediaSession() {
            if ('mediaSession' in navigator) {
                const song = state.songData[state.currentSongIndex];
                if (!song) return;
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: song.title,
                    artist: song.artist,
                    album: 'Play Nh·∫°c MSTQ',
                    artwork: [{ src: song.artwork, sizes: '512x512', type: 'image/jpeg' }]
                });
            }
        }

        // ==============================================
        // C√ÅC H√ÄM TI·ªÜN √çCH & S·ª∞ KI·ªÜN
        // ==============================================

        function setupEventListeners() {
            // Player controls
            dom.playPauseBtn.addEventListener('click', togglePlayPause);
            dom.nextBtn.addEventListener('click', playNext);
            dom.prevBtn.addEventListener('click', playPrev);
            dom.shuffleBtn.addEventListener('click', () => {
                state.isShuffling = !state.isShuffling;
                localStorage.setItem('isShuffling', state.isShuffling);
                dom.shuffleBtn.classList.toggle('active-control', state.isShuffling);
            });
            dom.repeatBtn.addEventListener('click', () => {
                const modes = ['none', 'all', 'one'];
                state.repeatMode = modes[(modes.indexOf(state.repeatMode) + 1) % modes.length];
                localStorage.setItem('repeatMode', state.repeatMode);
                updateRepeatButtonUI();
            });
            dom.favoriteBtn.addEventListener('click', () => {
                if (state.currentSongIndex !== -1) {
                    const songId = state.songData[state.currentSongIndex].id;
                    const index = state.favoriteSongIds.indexOf(songId);
                    if (index > -1) state.favoriteSongIds.splice(index, 1);
                    else state.favoriteSongIds.push(songId);
                    localStorage.setItem('favoriteSongIds', JSON.stringify(state.favoriteSongIds));
                    if(document.querySelector('#category-menu .active')?.dataset.category === 'favorites') loadCategory('favorites');
                    updateUI();
                }
            });

            // Audio events
            dom.audioPlayer.addEventListener('play', () => { state.isPlaying = true; updateUI(); updateMediaSession(); });
            dom.audioPlayer.addEventListener('pause', () => { state.isPlaying = false; updateUI(); });
            dom.audioPlayer.addEventListener('ended', () => {
                if (state.repeatMode === 'one') playSong(state.currentSongIndex);
                else playNext();
            });
            dom.audioPlayer.addEventListener('timeupdate', updateProgress);
            
            // Progress bar
            document.getElementById('progress-container').addEventListener('click', (e) => {
                if(dom.audioPlayer.duration) dom.audioPlayer.currentTime = (e.offsetX / e.currentTarget.clientWidth) * dom.audioPlayer.duration;
            });
            
            // Volume
            dom.volumeSlider.addEventListener('input', (e) => { dom.audioPlayer.volume = e.target.value; });

            // Search
            dom.searchInput.addEventListener('input', (e) => {
                const query = e.target.value;
                dom.searchClearBtn.classList.toggle('hidden', !query);
                if (query) {
                    const results = state.fuse.search(query).map(result => result.item);
                    renderSongs(results);
                } else {
                    const activeCategory = document.querySelector('#category-menu .active')?.dataset.category || 'all';
                    loadCategory(activeCategory);
                }
            });
            dom.searchClearBtn.addEventListener('click', () => {
                dom.searchInput.value = '';
                dom.searchClearBtn.classList.add('hidden');
                const activeCategory = document.querySelector('#category-menu .active')?.dataset.category || 'all';
                loadCategory(activeCategory);
            });

            // H·∫πn gi·ªù
            document.querySelectorAll('.sleep-timer-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const minutes = parseInt(e.target.dataset.minutes);
                    startSleepTimer(minutes);
                });
            });

            // Queue
            dom.queueToggleBtn.addEventListener('click', () => dom.body.classList.toggle('queue-open'));
            dom.queueOverlay.addEventListener('click', () => dom.body.classList.remove('queue-open'));

            // Navigation and Theme
            setupNavEvents();
        }

        function startSleepTimer(minutes) {
            clearTimeout(state.sleepTimer);
            if (minutes === 0) {
                dom.currentSleepTimerDisplay.textContent = 'Kh√¥ng h·∫πn gi·ªù';
                return;
            }
            dom.currentSleepTimerDisplay.textContent = `S·∫Ω t·∫Øt sau ${minutes} ph√∫t`;
            state.sleepTimer = setTimeout(() => {
                dom.audioPlayer.pause();
                dom.currentSleepTimerDisplay.textContent = 'ƒê√£ t·∫Øt nh·∫°c';
            }, minutes * 60 * 1000);
        }

        function addSongEventListeners() {
            document.querySelectorAll('.song-list-item').forEach(item => {
                item.addEventListener('click', () => {
                    const song = state.currentDisplayData[parseInt(item.dataset.displayIndex)];
                    const globalIndex = state.songData.findIndex(s => s.id === song.id);
                    playSong(globalIndex);
                });
            });
        }
        
        function setupNavEvents() {
            const hamburgerMenu = document.getElementById('hamburger-menu');
            const mobileNavOverlay = document.getElementById('mobile-nav-overlay');
            const closeMobileMenu = document.querySelector('.close-mobile-menu');
            const platformsToggleDesktop = document.getElementById('platforms-toggle-desktop');
            const platformsMenuDesktop = document.getElementById('platforms-menu-desktop');
            const platformsToggleMobile = document.getElementById('platforms-toggle-mobile');
            const platformsMenuMobile = document.getElementById('platforms-menu-mobile');
            const themeToggleDesktop = document.getElementById('theme-toggle-desktop');
            const themeMenuDesktop = document.getElementById('theme-menu-desktop');
            const mobileThemeMenu = document.getElementById('mobile-theme-menu');
            const mobileThemeOptions = document.getElementById('mobile-theme-options');

            hamburgerMenu.addEventListener('click', () => mobileNavOverlay.classList.add('active'));
            closeMobileMenu.addEventListener('click', () => mobileNavOverlay.classList.remove('active'));
            mobileNavOverlay.addEventListener('click', (e) => { if (e.target === mobileNavOverlay) mobileNavOverlay.classList.remove('active'); });
            
            const toggleDropdown = (toggle, menu) => {
                toggle.addEventListener('click', (e) => {
                    e.stopPropagation();
                    menu.classList.toggle('show');
                });
            };
            toggleDropdown(platformsToggleDesktop, platformsMenuDesktop);
            toggleDropdown(platformsToggleMobile, platformsMenuMobile);
            toggleDropdown(themeToggleDesktop, themeMenuDesktop);
            
            mobileThemeMenu.addEventListener('click', (e) => {
                e.stopPropagation();
                mobileThemeOptions.classList.toggle('hidden');
            });

            window.addEventListener('click', () => {
                platformsMenuDesktop.classList.remove('show');
                themeMenuDesktop.classList.remove('show');
            });

            [document.getElementById('darkModeToggle'), document.getElementById('darkModeToggleMobile')].forEach(toggle => {
                toggle.addEventListener('change', (e) => updateTheme({ mode: e.target.checked ? 'dark' : 'light' }));
            });
        }

        function renderPlatformLinks() {
            const containers = [document.getElementById('platforms-menu-desktop'), document.getElementById('platforms-menu-mobile')];
            containers.forEach(container => {
                container.innerHTML = '';
                config.platformLinks.forEach(link => {
                    container.innerHTML += `<a href="${link.url}" target="_blank"><i class="ph-bold ${link.icon}" style="color: ${link.color};"></i> ${link.name}</a>`;
                });
            });
        }

        function renderThemeButtons() {
            const containers = [document.getElementById('preset-themes-desktop'), document.getElementById('mobile-preset-themes')];
            containers.forEach(container => {
                if(container) {
                    container.innerHTML = '';
                    config.presetThemes.forEach(theme => {
                        const btn = document.createElement('button');
                        btn.className = 'preset-theme-btn';
                        btn.title = theme.title;
                        btn.style.cssText = theme.style;
                        btn.onclick = () => updateTheme({ mode: 'preset', bg: theme.bg, text: theme.text, cardBg: theme.cardBg, border: theme.border });
                        container.appendChild(btn);
                    });
                }
            });
        }

        // ==============================================
        // KH·ªûI CH·∫†Y ·ª®NG D·ª§NG
        // ==============================================
        initializeApp();
    });
    </script>
</body>
</html>
